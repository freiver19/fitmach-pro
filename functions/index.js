const functions = require('firebase-functions'); const admin = require('firebase-admin'); admin.initializeApp(); exports.assignDefaultRole = functions.auth.user().onCreate(async (user)=>{ const role='instructor'; await admin.auth().setCustomUserClaims(user.uid, {role}); await admin.firestore().collection('users').doc(user.uid).set({email:user.email, role, createdAt: admin.firestore.FieldValue.serverTimestamp()}); return null; }); exports.notifyNewOffer = functions.firestore.document('offers/{offerId}').onCreate(async (snap, ctx)=>{ const offer = snap.data(); const payload = { notification: { title: 'Nueva oferta disponible', body: `${offer.title} â€¢ ${offer.mode} en ${offer.location}` }, data: { offerId: ctx.params.offerId } }; return admin.messaging().sendToTopic('instructors', payload); });
