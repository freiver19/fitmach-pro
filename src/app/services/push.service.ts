import { Injectable } from '@angular/core'; import { Platform, ToastController } from '@ionic/angular'; import { PushNotifications, Token, PushNotificationSchema, ActionPerformed } from '@capacitor/push-notifications'; @Injectable({providedIn:'root'}) export class PushService { constructor(private platform: Platform, private toastCtrl: ToastController){} async init(){ if(!this.platform.is('hybrid')){ console.log('Web: no push native'); return; } let perm = await PushNotifications.checkPermissions(); if(perm.receive !== 'granted'){ perm = await PushNotifications.requestPermissions(); } if(perm.receive === 'granted'){ await PushNotifications.register(); PushNotifications.addListener('registration', async (token: Token)=>{ console.log('Token', token.value); await this.showToast('Registrado en notificaciones'); }); PushNotifications.addListener('pushNotificationReceived', async (n: PushNotificationSchema)=>{ await this.showToast(`${n.title}: ${n.body}`); }); PushNotifications.addListener('pushNotificationActionPerformed', (a: ActionPerformed)=>{ console.log('Action', a); }); } } private async showToast(msg:string){ const t = await this.toastCtrl.create({message:msg, duration:2000}); await t.present(); } }
